---
title: "Chocolate Chip Cookies"
execute:
  error: true
author: "Yixuan Li"
output: html_document
---

## Reading In the Data

First, read in the CSV data of cookie ingredients.
Make sure that your end-result data has appropriate types for each column - these should match the types provided in the documentation in the README.md file.

```{r}
# Load the dataset from the CSV file
cookies1 <- read.csv("choc_chip_cookie_ingredients.csv")

# Display the structure of the dataset
str(cookies1)

```

```{python}
import pandas as pd

# Load the dataset from the CSV file
cookies2 = pd.read_csv("choc_chip_cookie_ingredients.csv")

# Display the data types of each column
print(cookies2.dtypes)
```


## Exploratory Data Analysis

Exploratory data analysis is the process of getting familiar with your dataset. To get started, [this blog post](https://www.mrdbourke.com/a-gentle-introduction-to-exploratory-data-analysis/) provides a nice checklist to get you thinking:

> 1.  What question(s) are you trying to solve (or prove wrong)?
> 2.  What kind of data do you have and how do you treat different types?
> 3.  What's missing from the data and how do you deal with it?
> 4.  Where are the outliers and why should you care about them?
> 5.  How can you add, change or remove features to get more out of your data?

### Generating Questions

Generate at least 5 questions you might explore using this database of cookie ingredients.

1. Which ingredients are used most frequently across all cookie recipes?
2. Are there ingredient combinations that commonly appear together?
3. Is there a correlation between 'Quantity' and 'Rating'?
4. What is the most common measurement unit?
5. Does the variety of ingredients affect the rating?


### Skimming the Data

One thing we often want to do during EDA is to examine the quality of the data - are there missing values? What quirks might exist in the dataset?

The `skimr` package in R, and the similar `skimpy` package in python (which has a much better name, in my opinion), can help provide visual summaries of the data. 

Install both packages, and read the package documentation ([R](https://cran.r-project.org/web/packages/skimr/vignettes/skimr.html), [Python](https://pypi.org/project/skimpy/)).

[Part 1] Use each package and generate summaries of your data that require the use of at least some non-default options in each package's `skim` function.


```{r}
library(skimr)
library(dplyr)

# Summarize only character columns and display detailed statistics
cookies1 %>% skim() %>% yank("character")

```

```{python}
from skimpy import skim

# Summarize statistics specifically for the numeric columns
cookies_py = skim(cookies2[['Rating', 'Quantity']])

```

[Part 2] Write 1-2 sentences about what you can tell from each summary display you generate. Did you discover anything new about the data?

* I discovered that the dataset's descriptive parts, such as Ingredient, Unit, and Text, are perfectly intact with zero missing values. In contrast, the Rating and Quantity columns show many missing entries, indicating that while we have a full list of ingredients, we lack complete performance metrics for over half of the recipes.

### Generating Tables

Another useful technique for exploratory data analysis is to generate summary tables. 
You may want to use the `dplyr` package in R (`group_by` or `count` functions), as well as the `groupby` and `count` methods in Pandas. [Python example](https://sparkbyexamples.com/pandas/pandas-groupby-count-examples/), [R example](https://dplyr.tidyverse.org/reference/count.html)

[Part 1] Using R and Python, generate a table that shows what **proportion** of recipes contain each type of ingredient, for the most common 20 ingredients.
```{r}
# Calculate the total number of unique recipes
total_recipes_r <- cookies1 %>% summarise(n_distinct(Recipe_Index)) %>% pull()

# Identify the top 20 ingredients and calculate their proportions
top_20_r <- cookies1 %>% 
  count(Ingredient, sort = TRUE) %>% 
  slice_head(n = 20) %>% 
  mutate(proportion = n / total_recipes_r)

# Display the proportion table
print(top_20_r)
```

```{python}

# Calculate the total number of unique recipes
total_recipes_py = cookies2['Recipe_Index'].nunique()

# Identify the top 20 ingredients
top_20_py = (
    cookies2['Ingredient']
    .value_counts()
    .head(20)
    .reset_index()
)

# Rename these two labels
top_20_py.columns = ['Ingredient', 'count']

# Calculate the proportions
top_20_py['proportion'] = top_20_py['count'] / total_recipes_py

# Display the proportion table
print(top_20_py)
```
[Part 2] Print out a character string that lists all of the ingredients that do not appear in at least 20 recipes.

```{r}
# Count the number of each ingredient
all_ingredient_counts <- cookies1 %>% count(Ingredient)

# Filter for ingredients appearing in fewer than 20 recipes
rare_ingredients_r <- all_ingredient_counts %>% filter(n < 20)

# Format the rare ingredients as a single comma-separated string
rare_ingredients_list_r <- rare_ingredients_r %>% pull(Ingredient) %>% paste(collapse = ", ")
```
The ingredients that appear in fewer than 20 recipes are:`r rare_ingredients_list_r`

```{python}

# Count the number of each ingredient
ingredient_counts = cookies2['Ingredient'].value_counts()

# Filter for ingredients appearing in fewer than 20 recipes
rare_ingredients_py = ingredient_counts[ingredient_counts < 20].index.tolist()

# Convert the list into a single comma-separated string
rare_string_py = ", ".join(rare_ingredients_py)

# Display the rare ingredients string
print("The ingredients that appear in fewer than 20 recipes are:", rare_string_py)
```

### Visualization

Using whatever plotting system you are comfortable with in R or python, see if you can create a couple of useful exploratory data visualizations which address one of the questions you wrote above - or another question which you've come up with as you've worked on this assignment.

[Part 1] Create at least one plot (it doesn't have to be pretty) that showcases an interesting facet of the data.

```{r}
library(ggplot2)

# Pull the top 10 most common ingredients
top_10_r <- top_20_r %>% slice_head(n = 10)

# Build a horizontal bar chart of ingredient proportions
ggplot(top_10_r, aes(x = reorder(Ingredient, proportion), y = proportion)) +
  geom_col(fill = "steelblue") +
  coord_flip() + 
  labs(title = "Top 10 Ingredients", x = "Ingredient", y = "Proportion") +
  theme_minimal()
```

[Part 2] Write 2-3 sentences about what you can learn from that plot and what directions you might want to investigate from here.

* There is an interesting observation that the proportion of egg exceed 1, which seems like an error. Upon closer inspection, I find the egg category includes sub-ingredients like yolks or whites. Consequently, this leads to a total count that surpasses the number of recipes.